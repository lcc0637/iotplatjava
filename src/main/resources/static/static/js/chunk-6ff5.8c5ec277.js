(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6ff5"],{YAcO:function(t,e,a){"use strict";var s=a("Zzo+");a.n(s).a},"Zzo+":function(t,e,a){},k02v:function(t,e,a){"use strict";a.r(e);var s=a("P2sY"),i=a.n(s),o=a("gDS+"),l=a.n(o),r=a("MQ60"),n=a.n(r),c={name:"userdata",mixins:[a("y2a5").a],components:{Draggable:n.a},data:function(){return{myData:[],setuData:[],showEditUserData:!1,userDataForm:{id:0,user_id:this.$route.params.id,scope_table:"",scope_ids:"",sort:1,memo:"",version:0,cs1:"",cs2:"",op_name:"",cs1_title:"",ids_title:""},scopeidDatas:[],scopeTableDatas:[],dbTableData:[],delIds:[],roleListData:[],importRoleSel:"",importShow:!1,exportRoleSel:"",exportShow:!1}},mounted:function(){var t=this;this.callSrvAct("/dbtableinfo",{_hy:"dbtableinfo",encode:"ipincloud",version:"1.0.0"}).then(function(e){console.log("db table :",e),t.dbTableData=e.data||[]}),this.getUserDataList();this.callSrvAct("/actq",{_hy:"rolelist",qps:[{name:"title",val:"",op:"like"}],rop:1e4,cp:1}).then(function(e){e.data&&e.data.pageData&&(t.roleListData=e.data.pageData||[])})},methods:{getUserDataList:function(){var t=this,e={_hy:"userdatalist",qps:[{name:"user_id",val:this.$route.params.id,op:"="}]};this.callSrvAct("/actq",e).then(function(e){t.setuData=e.data||[],console.log("setuData:",t.setuData,e)})},removItem:function(t,e){var a=e.id;if(a>0){for(var s=!1,i=0;i<this.delIds.length;i++)if(this.delIds[i]==a){s=!0;break}s||this.delIds.push(a)}this.setuData.splice(t,1)},changeDataRange:function(t,e){console.log("v,item:",t,e),"公司"==t?(e.scope_ids=this.$store.state.globaldata.org.id+"",e.ids_title=this.$store.state.globaldata.org.title):"部门"==t&&(e.scope_ids=this.$route.params.parent_id+"",e.ids_title=this.$route.params.parent_title+""),"员工"==t&&(e.scope_ids=this.$route.params.id+"",e.ids_title=this.$route.params.title)},changeColRange:function(t,e){var a=t.colName,s=t.memo;e.cs1_title||(e.cs1_title="");var i=","+e.cs1+",",o=","+e.cs1_title+",";i.indexOf(","+a+",")>-1?(i=i.replace(","+a+",",","),o=o.replace(","+s+",",","),","==i[0]&&(e.cs1=i.slice(1),e.cs1_title=o.slice(1)),i.length>0&&","==i[i.length-1]&&(e.cs1=i.slice(1,i.length-1),e.cs1_title=o.slice(1,o.length-1))):(e.cs1=e.cs1.length>0?e.cs1+","+a:a,e.cs1_title=e.cs1_title.length>0?e.cs1_title+","+s:s)},showSetSel:function(t){return t==this.$route.params.parent_id+""?"部门":t==this.$route.params.id+""?"员工":t==this.$store.state.globaldata.org.id+""?"公司":""},showTableMemo:function(t){for(var e=0;e<this.dbTableData.length;e++)if(t==this.dbTableData[e].name)return this.dbTableData[e].memo||t;return t},showOpnameTitle:function(t){return"read"==t?"读取":"write"==t?"保存":"del"==t?"删除":""},showCs1:function(t){return"read"==t||"write"==t},getCs1CheckDatas:function(t){for(var e=0;e<this.dbTableData.length;e++)if(t==this.dbTableData[e].name)return this.dbTableData[e].cols||[];return[]},handleClose:function(){this.$router.go(-1)},saveUserData:function(){var t=this;this.$confirm("此操作将影响到用户的数据操作范围, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var e=0;e<t.setuData.length;e++)t.setuData[e].scope_ids||(t.setuData[e].scope_ids=t.$route.params.id+"",t.setuData[e].ids_title=t.$route.params.title),t.setuData[e].sort=e+1;var a={_hy:"userdataset",user_data:t.setuData,user_data_ids:t.delIds};t.callSrvAct("/act",a).then(function(e){t.delIds=[],t.getUserDataList(),t.$message.success("数据保存已成功.")})}).catch(function(e){t.$message.error(e)})},handleMoveStart:function(t){},handleMove:function(){return!0},hideEntityTable:function(t){if(!t)return!0;for(var e=0,a=0;a<this.setuData.length;a++)this.setuData[a].scope_table==t&&(e+=1);return 3==e||t.lastIndexOf("_attr")!=t.length-5&&t.indexOf("_")>-1},haveInSetu:function(t){for(var e=0;e<this.setuData.length;e++)if(this.setuData[e].scope_table==t)return!0;return!1},handleMoveEnd:function(t){return!0},handleItemAdd:function(t){var e=t.newIndex,a=JSON.parse(l()(this.setuData[e]));console.log("item:",a,this.setuData.length);for(var s=a.name,i=[],o="",r=0;r<e&&r<this.setuData.length;r++)this.setuData[r].scope_table==s&&(o=o+this.setuData[r].op_name+",");for(var n=e+1;n<this.setuData.length;n++)if(this.setuData[n].scope_table==s){o=o+this.setuData[n].op_name+",";break}o=","+o;for(var c,h=["read","write","del"],u=0;u<h.length;u++)o.indexOf(","+h[u]+",")<0&&i.push({id:0,user_id:this.$route.params.id,scope_table:s,scope_ids:this.$route.params.id+"",sort:e+u,memo:"",cs1:"",cs2:"",version:0,op_name:h[u],cs1_title:"",ids_title:this.$route.params.title});if(!(i.length>0))return this.setuData.splice(e,1),!0;(c=this.setuData).splice.apply(c,[e,1].concat(i))},importRoleData:function(){var t=this;if(this.importRoleSel){var e={_hy:"roledatalist",qps:[{name:"role_id",val:this.importRoleSel,op:"="}]};this.callSrvAct("/actq",e).then(function(e){for(var a=e.data||[],s=0;s<a.length;s++){for(var o=!1,l=0;l<t.setuData.length;l++)if(t.setuData[l].scope_table==a[s].scope_table&&t.setuData[l].op_name==a[s].op_name){o=!0;break}if(!o){var r=i()({},a[s]);r.user_id=t.$route.params.id,r.id=0,delete r.role_id,t.setuData.push(r)}}t.importShow=!1})}},exportRoleData:function(){var t=this;if(this.exportRoleSel){for(var e=[],a=0;a<this.setuData.length;a++){var s=i()({},this.setuData[a]);s.id=0,s.role_id=this.exportRoleSel,delete s.user_id,e.push(s)}var o={_hy:"roledataset",role_data:e,role_id:this.exportRoleSel};console.log("upData:",o),this.callSrvAct("/act",o).then(function(e){t.exportShow=!1,t.$message.success("数据导出已成功.")})}}}},h=(a("YAcO"),a("KHd+")),u=Object(h.a)(c,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"form-header form-header-back"},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"account"}}),a("span",{staticStyle:{height:"24px",display:"inline-block","margin-top":"12px"}},[t._v("用户管理")]),t._v(" "),a("el-button",{staticClass:"header-func",on:{click:t.handleClose}},[a("svg-icon",{attrs:{"icon-class":"close"}}),t._v("返回")],1),t._v(" "),a("el-popover",{attrs:{placement:"bottom",trigger:"click"},model:{value:t.importShow,callback:function(e){t.importShow=e},expression:"importShow"}},[a("el-button",{staticClass:"header-func",attrs:{slot:"reference"},slot:"reference"},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"login"}}),t._v("角色导入")],1),t._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.importRoleSel,callback:function(e){t.importRoleSel=e},expression:"importRoleSel"}},t._l(t.roleListData,function(t){return a("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-top":"10px"},on:{click:t.importRoleData}},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ok"}}),t._v("确定")],1)],1),t._v(" "),a("el-popover",{attrs:{placement:"bottom",trigger:"click"},model:{value:t.exportShow,callback:function(e){t.exportShow=e},expression:"exportShow"}},[a("el-button",{staticClass:"header-func",attrs:{slot:"reference"},slot:"reference"},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"logout"}}),t._v("导出角色")],1),t._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.exportRoleSel,callback:function(e){t.exportRoleSel=e},expression:"exportRoleSel"}},t._l(t.roleListData,function(t){return a("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-top":"10px"},on:{click:t.exportRoleData}},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ok"}}),t._v("确定")],1)],1),t._v(" "),a("el-button",{staticClass:"header-func",on:{click:t.saveUserData}},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"save"}}),t._v("保存")],1)],1),t._v(" "),a("el-main",{staticClass:"db-main"},[a("el-container",{staticStyle:{"overflow-y":"hidden"},attrs:{direction:"horizontal"}},[a("el-aside",{staticStyle:{width:"250px",height:"100%","overflow-y":"hidden","border-right":"1px solid #eee"}},[a("el-scrollbar",{staticClass:"scrollc tblist"},[a("draggable",{attrs:{tag:"ul",list:t.dbTableData,options:{group:{name:"userdata",pull:"clone",put:!1},sort:!1,ghostClass:"ghost"},move:t.handleMove},on:{start:t.handleMoveStart}},t._l(t.dbTableData,function(e,s){return t.hideEntityTable(e.name)?t._e():a("li",{key:s,staticClass:"li_tb"},[a("span",{staticStyle:{"padding-left":"10px",width:"150px"}},[t._v(t._s(e.memo||e.name))])])})),t._v(" "),a("div",{staticStyle:{height:"2px"}})],1),t._v(" "),a("div",{staticStyle:{position:"absolute",height:"15px",bottom:"0px",left:"0px",width:"249px",background:"#fff"}})],1),t._v(" "),a("el-main",{staticStyle:{height:"100%","overflow-y":"hidden",padding:"0px",margin:"0px"}},[a("el-scrollbar",{staticClass:"scrollcode "},[a("draggable",{staticClass:"code-list",attrs:{tag:"ul",options:{group:{name:"userdata"},put:{function:"canPut"},ghostClass:"ghost"}},on:{end:t.handleMoveEnd,add:t.handleItemAdd},model:{value:t.setuData,callback:function(e){t.setuData=e},expression:"setuData"}},t._l(t.setuData,function(e,s){return a("li",{key:s,staticClass:"li_tb"},[a("span",{staticClass:"leftt"},[t._v("数据表单:")]),t._v(" "),a("span",{staticStyle:{"padding-left":"10px","font-size":"14px"}},[t._v(t._s(t.showTableMemo(e.scope_table))+"\n                ")]),t._v(" "),a("span",{staticClass:"leftt"},[t._v("动作名称:")]),t._v(" "),a("span",{staticStyle:{"padding-left":"10px","font-size":"14px"}},[t._v(t._s(t.showOpnameTitle(e.op_name)))]),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-right":"10px"},attrs:{type:"text",size:"small"},on:{click:function(a){t.removItem(s,e)}}},[t._v("移除")]),t._v(" "),a("div",[a("span",{staticClass:"leftt"},[t._v("数据范围:")]),t._v(" "),a("span",{staticStyle:{"padding-left":"10px","font-size":"14px"}},[t._v(t._s(e.ids_title))]),t._v(" "),a("el-popover",{staticStyle:{float:"right","margin-right":"-26px"},attrs:{placement:"right",trigger:"click"}},[a("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t._v("设置")]),t._v(" "),a("el-radio-group",{attrs:{size:"mini",value:t.showSetSel(e.scope_ids)}},[a("el-radio",{staticStyle:{display:"block"},attrs:{label:"公司"},on:{change:function(a){t.changeDataRange("公司",e)}}}),t._v(" "),a("el-radio",{staticStyle:{display:"block"},attrs:{label:"部门"},on:{change:function(a){t.changeDataRange("部门",e)}}}),t._v(" "),a("el-radio",{staticStyle:{display:"block"},attrs:{label:"员工"},on:{change:function(a){t.changeDataRange("员工",e)}}}),t._v(" "),a("el-radio",{staticStyle:{display:"block"},attrs:{label:"自定义"},on:{change:function(a){t.changeDataRange("自定义",e)}}})],1)],1)],1),t._v(" "),t.showCs1(e.op_name)?a("div",[a("span",{staticClass:"leftt"},[t._v("隐藏数列:")]),t._v(" "),a("span",{staticClass:"showtitle"},[t._v(t._s(e.cs1_title))]),t._v(" "),a("el-popover",{staticStyle:{float:"right","margin-right":"10px"},attrs:{placement:"right",trigger:"click"}},[a("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t._v("设置")]),t._v(" "),a("el-checkbox-group",{attrs:{size:"mini",value:e.cs1.split(",")}},t._l(t.getCs1CheckDatas(e.scope_table),function(s,i){return a("el-checkbox",{key:s.colName,staticStyle:{display:"block"},attrs:{label:s.colName},on:{change:function(a){t.changeColRange(s,e)}}},[t._v(t._s(s.memo)+"\n                      ")])}))],1)],1):t._e()],1)})),t._v(" "),a("div",{staticStyle:{height:"2px"}})],1),t._v(" "),a("div",{staticStyle:{position:"absolute",height:"15px",bottom:"0px",left:"251px",right:"0px",background:"#fff"}})],1)],1)],1)],1)},[],!1,null,"0cd901ed",null);u.options.__file="index.vue";e.default=u.exports},y2a5:function(t,e,a){"use strict";var s=a("gDS+"),i=a.n(s),o=a("4d7F"),l=a.n(o);e.a={methods:{cb_null:function(t){return!1},cb_goBack:function(t){return this.$router.go(-1),!0},cb_success:function(t){return!(!t.status||"SUCCESS"!=t.status)||(this.$message.error(t.msg),!1)},cb_showMess:function(t){return this.$message.success(t.msg),!0},gen_sameValue:function(t,e){return function(a,s,i){s!=t?i(new Error(e)):i()}},refreshCaptcha:function(t){t.preventDefault(),t.target.src=this.hysrvport+"/captcha?"+Math.random()},add_authToken:function(t){return t.length<1?"":t=t.indexOf("?")>-1?t+"&Authorization="+this.apiSrv.token:t+"?Authorization="+this.apiSrv.token},callServer:function(t,e,a){var s=this;this.apiSrv.callServer(t,e).then(function(t){if(console.log("res ------",t),a)for(var e=0;e<a.length;e++){if(!a[e](t))break}}).catch(function(t){console.log("err:",t),s.$message.error(t)})},callSrvAct:function(t,e){var a=this;return new l.a(function(s,i){a.apiSrv.callServer(t,e).then(function(t){t.status&&"SUCCESS"==t.status?s(t):(console.log("res:",t),a.$message.error(t.msg))}).catch(function(t){console.log("err:",t),a.$message.error(t)})})},gen_list_cb:function(t,e){var a=this;if(!t||t.length<1)return this.cb_null;var s=t+"Data",i=t+"TotalRec",o=t+"TotalPage",l=t+"RecOfPage",r=t+"CurPage";return function(t){return e&&1==e&&t.data.cp>1?a[s]=a[s].concat(t.data.pageData||[]):a[s]=t.data.pageData||[],a[i]=t.data.totalRec,a[l]=t.data.rop,a[r]=t.data.cp,a[o]=t.data.rop>0?Math.ceil(t.data.totalRec/t.data.rop):0,t.data.detailData&&(a[s+"dData"]=t.data.detailData||[]),!0}},gen_selmulti_change:function(t){var e=this;if(!t||t.length<1)return this.cb_null;var a=t+"MultiSel";return function(t){if(e[a]){for(var s=[],i=0;i<t.length;i++)s.push(t[i].id);e[a]=s}}},refreshPage2:function(t,e,a,s,o){var l=t+"QueryArr",r=t+"CbPage",n=JSON.parse(i()(this[l]));if(n&&n.length>0)for(var c=n.length-1;c>-1;c--)console.log("qpsArr[i].val",n[c].val,0==n[c].val,""!=n[c].val),0==n[c].val&&(console.log("i:",c),n.splice(c,1));console.log("qpsArr:",n,this[l]);var h={qps:n||"",rop:a,cp:s};return this[t+"SortParas"]&&(h.sps=this[t+"SortParas"]),h._hy=o,this.callServer(e,h,[this.cb_success,this[r]])},refreshPage:function(t,e,a){var s=t+"RecOfPage",i=t+"CurPage";this[i]<1&&(this[i]=1),this.refreshPage2(t,e,this[s],this[i],a)},queryPageData:function(t,e,a,s,o){if(!t||t.length<1)return this.cb_null;var l=t+"QueryArr",r=JSON.parse(i()(this[l]));if(r&&r.length>0)for(var n=r.length-1;n>-1;n--)0==r[n].val&&r.splice(n,1);console.log("qpsArr:",r);var c={qps:r||[],rop:a,cp:s};return this[t+"SortParas"]&&(c.sps=this[t+"SortParas"]),this.callServer(e,c,o)}}}}}]);